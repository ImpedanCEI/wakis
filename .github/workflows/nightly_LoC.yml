# This is a basic workflow that is nighly triggered

name: nightly_LoC

# Controls when the action will run. CRON schedule runs at mm hh dd mm yy UTC TIME
on:
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  LoC:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Make the default shell a login shell, so that conda is initialised properly
    defaults:
      run:
        shell: bash -el {0}

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
    - name: Print versions
      run: conda list
    - name: Checkout wakis
      uses: actions/checkout@v4
      with:
        path: wakis
    - name: Lines of Code Badge
      # You may pin to the exact commit or the version.
      # uses: shadowmoose/GHA-LoC-Badge@8c8191e02ebe2e4b4764f4711228bddcaeb88f19
      uses: shadowmoose/GHA-LoC-Badge@1.0.0
      with:
        # The directory to scan.
        directory: wakis/ # optional, default is ./
        # The output path to save the badge svg - including extension!
        badge: ./badge.svg # optional, default is ./badge.svg
        # The file patterns to search for, separated by pipes ("|").
        patterns: '*.png | *.svg' # optional, default is **
        # The file patterns to ignore, even if they matched "patterns", separated by pipes ("|").
        #ignore: # optional, default is node_modules
        # The label to use for the badge.
        #badge_label: # optional, default is Lines of Code
        # The color to use for the badge.
        #badge_color: # optional, default is blue
        # The body style to use for the badge. ('flat' or 'classic')
        #badge_style: # optional, default is classic
        # The scale to resize this badge
        #badge_scale: # optional, default is 1
        # The color to use for this badge label.
        #badge_labelcolor: # optional, default is 555
        # Enable debug logging
        debug: true # optional, default is false
    - name: Upload badge to gh-pages branch
      if: github.ref == 'refs/heads/main'
      run: |
        cd wakis
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        git fetch origin gh-pages || git checkout --orphan gh-pages
        git checkout gh-pages || git checkout --orphan gh-pages
        cp ./badge.svg ./badge.svg
        git add badge.svg
        git commit -m "Update LoC badge [skip ci]" || echo "No changes to commit"
        git push origin gh-pages
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        #  ![Lines of Code](https://raw.githubusercontent.com/ImpedanCEI/wakis/gh-pages/badge.svg)        
